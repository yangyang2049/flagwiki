# 国歌播放功能测试指南

## 🎵 测试步骤

### 1. 基本播放测试

1. 打开应用，进入"国歌"标签页
2. 点击任意国家（例如：中国）
3. 观察底部播放控制器是否出现
4. 点击播放按钮▶️
5. **预期结果**：
   - ✅ 国歌开始播放
   - ✅ 播放按钮变为暂停按钮⏸️
   - ✅ 进度条开始移动
   - ✅ 时间显示更新（例如：00:03 / 02:45）

### 2. 进度条测试

1. 播放国歌时，拖动进度条到中间位置
2. **预期结果**：
   - ✅ 音频跳转到对应位置
   - ✅ 时间显示正确更新
   - ✅ 继续播放

### 3. 播放控制测试

1. 点击**暂停按钮**⏸️
   - ✅ 音频暂停
   - ✅ 按钮变回播放▶️
   - ✅ 进度条停止移动

2. 点击**下一首按钮**⏭️
   - ✅ 切换到下一个国家的国歌
   - ✅ 自动开始播放
   - ✅ 显示新国家的信息

3. 点击**上一首按钮**⏮️
   - ✅ 切换到上一个国家的国歌
   - ✅ 自动开始播放

### 4. 格式支持测试

国歌文件使用 **OGG Vorbis** 格式，HarmonyOS 原生支持，无需转换。

- 已下载文件：188 个国家的国歌
- 文件位置：`entry/src/main/resources/rawfile/anthems/`
- 命名规则：`anthem_{国家代码}.ogg`（例如：`anthem_cn.ogg`）

### 5. 已知问题

如果播放失败，请检查：

1. **文件存在**：确认国歌文件已下载到 rawfile/anthems/ 目录
2. **权限配置**：确认 module.json5 中已添加网络权限（虽然本地播放不需要，但部分语音功能需要）
3. **日志输出**：查看 Logcat 中 MediaService 的日志输出

## 🔧 调试技巧

### 查看日志

```bash
# 过滤 MediaService 日志
hdc hilog | grep MediaService
```

关键日志输出：
- `loadAsset musicIndex: X` - 加载音频
- `loadAsset avPlayer url loaded, fd: X` - 成功加载文件描述符
- `AVPlayer state prepared called` - 播放器准备完成
- `AVPlayer state playing called` - 开始播放

### 常见错误

1. **"getRawFd failed"**：文件不存在或路径错误
2. **"AVPlayer prepare failed"**：音频文件损坏或格式不支持
3. **播放器卡住不动**：可能是之前的 reset() 调用导致的状态混乱（已修复）

## 📊 测试结果记录

| 测试项 | 状态 | 备注 |
|--------|------|------|
| 基本播放 | ⬜ | |
| 进度条拖动 | ⬜ | |
| 暂停/恢复 | ⬜ | |
| 切换上/下一首 | ⬜ | |
| 时间显示 | ⬜ | |
| OGG 格式播放 | ⬜ | |

## 🎯 成功标准

- ✅ 所有 188 个国家的国歌能正常播放
- ✅ 进度条正确显示和响应
- ✅ 播放控制（播放/暂停/上一首/下一首）正常工作
- ✅ 时间显示准确
- ✅ 无内存泄漏或崩溃

---

**最后更新**: 2025-12-15


