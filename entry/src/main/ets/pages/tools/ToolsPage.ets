import router from '@ohos.router';

interface ToolItem {
    name: string;
    desc: string;
    pageUrl: string;
    icon: Resource;
}

interface ToolSection {
    title: string;
    icon: string;
    color: string;
    tools: ToolItem[];
}

@Component
export struct ToolsPage {
    @Prop layoutMode: 'grid' | 'list' = 'grid';

    private sections: ToolSection[] = [
        {
            title: 'ç¨ŽåŠ¡è®¡ç®—å™¨',
            icon: 'ðŸ§®',
            color: '#1677FF',
            tools: [
                { name: 'ä¸ªç¨Žè®¡ç®—å™¨ï¼ˆå·¥èµ„ï¼‰', desc: 'è®¡ç®—å·¥èµ„è–ªé‡‘ä¸ªäººæ‰€å¾—ç¨Ž', pageUrl: 'pages/tools/SalaryTaxPage', icon: $r('app.media.icon_tool_salary') },
                { name: 'ä¸ªç¨Žè®¡ç®—å™¨ï¼ˆå¹´ç»ˆå¥–ï¼‰', desc: 'å¹´ç»ˆå¥–å•ç‹¬è®¡ç¨Žæˆ–åˆå¹¶è®¡ç¨Ž', pageUrl: 'pages/tools/BonusTaxPage', icon: $r('app.media.icon_tool_bonus') },
                { name: 'äº”é™©ä¸€é‡‘è®¡ç®—', desc: 'ç¤¾ä¿å…¬ç§¯é‡‘ç¼´çº³é‡‘é¢æµ‹ç®—', pageUrl: 'pages/tools/InsurancePage', icon: $r('app.media.icon_tool_insurance') },
                { name: 'å°è§„æ¨¡çº³ç¨Žäººå¢žå€¼ç¨Ž', desc: '3%å¾æ”¶çŽ‡å¢žå€¼ç¨Žè®¡ç®—', pageUrl: 'pages/tools/SmallVatPage', icon: $r('app.media.icon_tool_small_vat') },
                { name: 'ä¸€èˆ¬çº³ç¨Žäººå¢žå€¼ç¨Ž', desc: 'å«è¿›é¡¹æŠµæ‰£çš„VATè®¡ç®—', pageUrl: 'pages/tools/GeneralVatPage', icon: $r('app.media.icon_tool_general_vat') },
                { name: 'ä¸ªä½“æˆ·æ ¸å®šå¾æ”¶', desc: 'ä¸ªä½“å·¥å•†æˆ·ç¨Žé¢è®¡ç®—', pageUrl: 'pages/tools/IndividualTaxPage', icon: $r('app.media.icon_tool_individual') },
                { name: 'ä¼ä¸šæ‰€å¾—ç¨Ž', desc: 'æŸ¥è´¦å¾æ”¶/æ ¸å®šå¾æ”¶', pageUrl: 'pages/tools/CorporateTaxPage', icon: $r('app.media.icon_tool_corporate') },
                { name: 'é™„åŠ ç¨Žè®¡ç®—', desc: 'åŸŽå»ºç¨Žã€æ•™è‚²é™„åŠ ç­‰', pageUrl: 'pages/tools/SurtaxPage', icon: $r('app.media.icon_tool_surtax') },
                { name: 'å°èŠ±ç¨Žè®¡ç®—', desc: 'åˆåŒç±»åž‹å°èŠ±ç¨ŽçŽ‡', pageUrl: 'pages/tools/StampTaxPage', icon: $r('app.media.icon_tool_stamp_tax') },
                { name: 'è‚¡æƒåˆ†çº¢ç¨Ž', desc: 'ä¸ªäºº/ä¼ä¸šåˆ†çº¢ç¨Žè®¡ç®—', pageUrl: 'pages/tools/DividendTaxPage', icon: $r('app.media.icon_tool_dividend') },
                { name: 'ç¨Žæ¬¾æ»žçº³é‡‘', desc: 'è®¡ç®—ç¨Žæ¬¾æ»žçº³é‡‘', pageUrl: 'pages/tools/TaxPenaltyPage', icon: $r('app.media.icon_tool_tax_calendar') }
            ]
        },
        {
            title: 'è´¢åŠ¡ä¸Žç»è¥è®¡ç®—',
            icon: 'ðŸ“±',
            color: '#52C41A',
            tools: [
                { name: 'ç›ˆäºå¹³è¡¡ç‚¹', desc: 'è®¡ç®—ä¿æœ¬é”€å”®é‡/é‡‘é¢', pageUrl: 'pages/tools/BreakEvenPage', icon: $r('app.media.icon_tool_breakeven') },
                { name: 'æ¯›åˆ©/å‡€åˆ©çŽ‡', desc: 'åˆ©æ¶¦çŽ‡å¿«é€Ÿè®¡ç®—', pageUrl: 'pages/tools/ProfitMarginPage', icon: $r('app.media.icon_tool_profit_margin') },
                { name: 'è´·æ¬¾è®¡ç®—å™¨', desc: 'ç­‰é¢æœ¬æ¯/ç­‰é¢æœ¬é‡‘', pageUrl: 'pages/tools/LoanCalcPage', icon: $r('app.media.icon_tool_loan') },
                { name: 'æŠ˜æ—§æ‘Šé”€', desc: 'ç›´çº¿æ³•æŠ˜æ—§è®¡ç®—', pageUrl: 'pages/tools/DepreciationPage', icon: $r('app.media.icon_tool_depreciation') },
                { name: 'åŠ ç­è´¹è®¡ç®—', desc: 'å·¥ä½œæ—¥/å‘¨æœ«/èŠ‚å‡æ—¥', pageUrl: 'pages/tools/OvertimePage', icon: $r('app.media.icon_tool_overtime') },
                { name: 'ç¦»èŒè¡¥å¿é‡‘', desc: 'ç»æµŽè¡¥å¿é‡‘æµ‹ç®—', pageUrl: 'pages/tools/SeverancePage', icon: $r('app.media.icon_tool_severance') },
                { name: 'äººæ°‘å¸å¤§å†™', desc: 'é‡‘é¢è½¬ä¸­æ–‡å¤§å†™', pageUrl: 'pages/tools/RmbUpperCasePage', icon: $r('app.media.icon_tool_exchange_rate') },
                { name: 'æŠ•èµ„æ”¶ç›Šè®¡ç®—', desc: 'å•åˆ©/å¤åˆ©æ”¶ç›Šè®¡ç®—', pageUrl: 'pages/tools/InvestmentReturnPage', icon: $r('app.media.icon_tool_profit_margin') },
                { name: 'å¤åˆ©è®¡ç®—å™¨', desc: 'å¤åˆ©ç»ˆå€¼ç²¾ç¡®è®¡ç®—', pageUrl: 'pages/tools/CompoundInterestPage', icon: $r('app.media.icon_tool_profit_margin') }
            ]
        },
        {
            title: 'å‘ç¥¨ä¸Žåˆè§„',
            icon: 'ðŸ“„',
            color: '#FA8C16',
            tools: [
                { name: 'å‘ç¥¨çœŸä¼ªæŸ¥è¯¢', desc: 'è·³è½¬ç¨ŽåŠ¡æ€»å±€æŸ¥éªŒ', pageUrl: 'pages/tools/InvoiceVerifyPage', icon: $r('app.media.icon_tool_invoice_verify') },
                { name: 'å‘ç¥¨ç±»åž‹è¯´æ˜Ž', desc: 'ä¸“ç¥¨/æ™®ç¥¨åŒºåˆ«è¯¦è§£', pageUrl: 'pages/tools/InvoiceTypePage', icon: $r('app.media.icon_tool_invoice_type') },
                { name: 'å¼€ç¥¨ç¨Žç‚¹åˆ—è¡¨', desc: 'å„è¡Œä¸šç¨ŽçŽ‡é€ŸæŸ¥', pageUrl: 'pages/tools/TaxRateListPage', icon: $r('app.media.icon_tool_tax_rate_list') },
                { name: 'çº³ç¨Žäººèº«ä»½', desc: 'å°è§„æ¨¡vsä¸€èˆ¬çº³ç¨Žäºº', pageUrl: 'pages/tools/TaxpayerTypePage', icon: $r('app.media.icon_tool_taxpayer_type') },
                { name: 'ç¨ŽåŠ¡æ—¥åŽ†', desc: 'ç”³æŠ¥æˆªæ­¢æ—¥æœŸæé†’', pageUrl: 'pages/tools/TaxCalendarPage', icon: $r('app.media.icon_tool_tax_calendar') },
                { name: 'ä¼šè®¡ç§‘ç›®æ±‡æ€»', desc: 'å¸¸ç”¨ä¼šè®¡ç§‘ç›®æŸ¥è¯¢', pageUrl: 'pages/tools/AccountingSubjectPage', icon: $r('app.media.icon_tool_tax_rate_list') },
                { name: 'è´¢ç¨Žæ³•è§„åº“', desc: 'è´¢ç¨Žæ³•è§„æŸ¥è¯¢ç´¢å¼•', pageUrl: 'pages/tools/TaxLawLibraryPage', icon: $r('app.media.icon_tool_tax_rate_list') },
                { name: 'ç¨ŽåŠ¡è¿æ³•ä¸¾æŠ¥', desc: 'ä¸¾æŠ¥ç¨Žæ”¶è¿æ³•è¡Œä¸º', pageUrl: 'pages/tools/ReportPage', icon: $r('app.media.icon_tool_invoice_verify') },
                { name: 'è®¡ç®—å™¨', desc: 'åŸºç¡€è®¡ç®—å·¥å…·', pageUrl: 'pages/tools/CalculatorPage', icon: $r('app.media.icon_tool_exchange_rate') }
            ]
        },
        {
            title: 'æŠ¥é”€ç®¡ç†',
            icon: 'ðŸ’°',
            color: '#EB2F96',
            tools: [
                { name: 'æŠ¥é”€æµç¨‹', desc: 'å®Œæ•´æŠ¥é”€æµç¨‹å›¾', pageUrl: 'pages/tools/ReimbursementProcessPage', icon: $r('app.media.icon_tool_invoice_verify') },
                { name: 'è´¢åŠ¡å®¡æ ¸æ¸…å•', desc: 'å‘ç¥¨è´¹ç”¨é¢„ç®—å®¡æ ¸', pageUrl: 'pages/tools/ReimbursementChecklistPage', icon: $r('app.media.icon_tool_invoice_type') },
                { name: 'ä¼šè®¡åˆ†å½•æ¨¡æ¿', desc: 'å·®æ—…åŠžå…¬æ‹›å¾…è´¹ç­‰', pageUrl: 'pages/tools/ReimbursementEntryPage', icon: $r('app.media.icon_tool_tax_rate_list') }
            ]
        }
    ];

    private getGridColumns(): string {
        // å›ºå®šä½¿ç”¨3åˆ—å¸ƒå±€
        return '1fr 1fr 1fr';
    }

    private handleNavigation(pageUrl: string): void {
        router.pushUrl({ url: pageUrl }).catch((err: Error) => {
            // å¯¼èˆªå¤±è´¥æ—¶åœ¨æŽ§åˆ¶å°è®°å½•ï¼Œå¯ä»¥åŽç»­æ·»åŠ UIæç¤º
            console.error(`Navigation failed: ${err.message}`);
        });
    }

    build() {
        Scroll() {
            Column() {
                // å·¥å…·åˆ—è¡¨
                ForEach(this.sections, (section: ToolSection, sectionIndex: number) => {
                    Column() {
                        // Section Header
                        Row() {
                            Text(section.title)
                                .fontSize(17)
                                .fontWeight(FontWeight.Bold)
                                .fontColor($r('app.color.button_primary'))
                        }
                            .width('100%')
                            .padding({ left: 16, right: 16, top: 16, bottom: 12 })

                        // Tools - Grid or List
                        if (this.layoutMode === 'grid') {
                            this.buildGridLayout(section, sectionIndex, this.getGridColumns(), (url: string) => {
                                this.handleNavigation(url);
                            })
                        } else {
                            this.buildListLayout(section, (url: string) => {
                                this.handleNavigation(url);
                            })
                        }
                    }
                })
            }
                .width('100%')
                .padding({ top: 8, bottom: 16 })
        }
            .width('100%')
            .scrollBar(BarState.Off)
            .edgeEffect(EdgeEffect.Spring)
            .backgroundColor($r('app.color.bg_page'))
    }

    @Builder
    buildGridLayout(section: ToolSection, sectionIndex: number, columnsTemplate: string, handleNav: (url: string) => void) {
        Grid() {
            ForEach(section.tools, (tool: ToolItem) => {
                GridItem() {
                    Column() {
                        Image(tool.icon)
                            .width(24)
                            .height(24)
                            .margin({ bottom: 8 })
                        Text(tool.name)
                            .fontSize(13)
                            .fontWeight(FontWeight.Medium)
                            .fontColor($r('app.color.text_primary'))
                            .textAlign(TextAlign.Start)
                            .maxLines(sectionIndex === 0 ? 2 : 1)
                            .textOverflow({ overflow: TextOverflow.Ellipsis })
                    }
                        .width('100%')
                        .justifyContent(FlexAlign.Start)
                        .alignItems(HorizontalAlign.Start)
                        .padding(12)
                        .onClick(() => {
                            handleNav(tool.pageUrl);
                        })
                }
            })
        }
            .columnsTemplate(columnsTemplate)
            .rowsGap(8)
            .columnsGap(8)
            .width('100%')
            .padding(12)
            .backgroundColor($r('app.color.bg_card'))
            .margin({ left: 16, right: 16, bottom: 16 })
    }

    @Builder
    buildListLayout(section: ToolSection, handleNav: (url: string) => void) {
        Column() {
            ForEach(section.tools, (tool: ToolItem) => {
                Row() {
                    Image(tool.icon)
                        .width(24)
                        .height(24)
                        .margin({ right: 12 })
                    Column() {
                        Text(tool.name)
                            .fontSize(15)
                            .fontWeight(FontWeight.Medium)
                            .fontColor($r('app.color.text_primary'))
                            .alignSelf(ItemAlign.Start)
                        Text(tool.desc)
                            .fontSize(13)
                            .fontColor($r('app.color.text_secondary'))
                            .margin({ top: 4 })
                            .alignSelf(ItemAlign.Start)
                    }
                        .layoutWeight(1)
                        .alignItems(HorizontalAlign.Start)
                    Image($r('app.media.icon_arrow_right'))
                        .width(16)
                        .height(16)
                }
                    .width('100%')
                    .padding(16)
                    .backgroundColor($r('app.color.bg_card'))
                    .borderRadius(8)
                    .margin({ bottom: 8 })
                    .onClick(() => {
                        handleNav(tool.pageUrl);
                    })
            })
        }
            .width('100%')
            .padding(12)
            .backgroundColor($r('app.color.bg_card'))
            .margin({ left: 16, right: 16, bottom: 16 })
    }

}
